services:
  userdb:
    image: postgres:18
    networks:
      - marketspace

  catalogdb:
    image: postgres:18
    networks:
      - marketspace
  
  minio:
    image: minio/minio:latest
    networks:
      - marketspace
  
  basketdb:
    image: mongo:latest
    ports:
      - "27017:27017"
    volumes:
      - mongo_basket_data:/data/db
    networks:
      - marketspace
  
  #  distributedcache:
  #    image: redis:latest
  
  orderdb:
    image: postgres:18
    networks:
      - marketspace

  merchantdb:
    image: postgres:18
    networks:
      - marketspace
  #
  #  messagebroker:
  #    image: rabbitmq:management
  
  catalog.api:
    image: ${DOCKER_REGISTRY-}catalogapi
    depends_on:
      - catalogdb
    build:
      context: .
      dockerfile: ./src/Services/Catalog/Catalog.Api/Dockerfile
    networks:
      - marketspace
  
  basket.api:
    image: ${DOCKER_REGISTRY-}basketapi
    depends_on:
      - basketdb
    build:
      context: .
      dockerfile: ./src/Services/Basket/Basket.Api/Dockerfile
    networks:
      - marketspace
  
  #  discount.grpc:
  #    image: ${DOCKER_REGISTRY-}discountgrpc
  #    build:
  #      context: .
  #      dockerfile: ./src/Services/Discount/Discount.Grpc/Dockerfile
  #  
  order.api:
    image: ${DOCKER_REGISTRY-}orderapi
    build:
      context: .
      dockerfile: ./src/Services/Order/Order.Api/Dockerfile
    networks:
      - marketspace

  merchant.api:
    image: ${DOCKER_REGISTRY-}merchantapi
    build:
      context: .
      dockerfile: ./src/Services/Merchant/Merchant.Api/Dockerfile
    networks:
      - marketspace
  
  user.api:
    image: ${DOCKER_REGISTRY-}userapi
    depends_on:
      - userdb
    build:
      context: .
      dockerfile: ./src/Services/User/Dockerfile
    networks:
      - marketspace
  
  backendforfrontend.api:
    image: ${DOCKER_REGISTRY-}backendforfrontendapi
    build:
      context: .
      dockerfile: ./src/Edges/BackendForFrontend.Api/Dockerfile
    networks:
      - marketspace
  
  webapp:
    image: ${DOCKER_REGISTRY-}webapp
    build:
      context: .
      dockerfile: ./uis/WebApp/Dockerfile
    networks:
      - marketspace

networks:
  marketspace:
    driver: bridge

volumes:
  postgres_catalog:
  postgres_user:
  postgres_order:
  postgres_merchant:
  postgres_basket:
  minio_data:
  webapp:
