services:
  compose-dashboard:
    image: "mcr.microsoft.com/dotnet/nightly/aspire-dashboard:latest"
    ports:
      - "18888"
    expose:
      - "18889"
      - "18890"
    networks:
      - "aspire"
    restart: "always"
  postgres-catalog:
    image: "docker.io/library/postgres:17.6"
    environment:
      POSTGRES_HOST_AUTH_METHOD: "scram-sha-256"
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256 --auth-local=scram-sha-256"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "CatalogDb"
    expose:
      - "5432"
    volumes:
      - type: "volume"
        target: "/var/lib/postgresql/data"
        source: "marketspace.apphost-b8d6486485-postgres-catalog-data"
        read_only: false
    networks:
      - "aspire"
  postgres-order:
    image: "docker.io/library/postgres:17.6"
    environment:
      POSTGRES_HOST_AUTH_METHOD: "scram-sha-256"
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256 --auth-local=scram-sha-256"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "OrderDb"
    expose:
      - "5432"
    volumes:
      - type: "volume"
        target: "/var/lib/postgresql/data"
        source: "marketspace.apphost-b8d6486485-postgres-order-data"
        read_only: false
    networks:
      - "aspire"
  postgres-merchant:
    image: "docker.io/library/postgres:17.6"
    environment:
      POSTGRES_HOST_AUTH_METHOD: "scram-sha-256"
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256 --auth-local=scram-sha-256"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "MerchantDb"
    expose:
      - "5432"
    volumes:
      - type: "volume"
        target: "/var/lib/postgresql/data"
        source: "marketspace.apphost-b8d6486485-postgres-merchant-data"
        read_only: false
    networks:
      - "aspire"
  postgres-user:
    image: "docker.io/library/postgres:17.6"
    environment:
      POSTGRES_HOST_AUTH_METHOD: "scram-sha-256"
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256 --auth-local=scram-sha-256"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "UserDb"
    expose:
      - "5432"
    volumes:
      - type: "volume"
        target: "/var/lib/postgresql/data"
        source: "marketspace.apphost-b8d6486485-postgres-user-data"
        read_only: false
    networks:
      - "aspire"
  postgres-basket:
    image: "docker.io/library/postgres:17.6"
    environment:
      POSTGRES_HOST_AUTH_METHOD: "scram-sha-256"
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256 --auth-local=scram-sha-256"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "BasketDb"
    expose:
      - "5432"
    volumes:
      - type: "volume"
        target: "/var/lib/postgresql/data"
        source: "marketspace.apphost-b8d6486485-postgres-basket-data"
        read_only: false
    networks:
      - "aspire"
  postgres-payment:
    image: "docker.io/library/postgres:17.6"
    environment:
      POSTGRES_HOST_AUTH_METHOD: "scram-sha-256"
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256 --auth-local=scram-sha-256"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "PaymentDb"
    expose:
      - "5432"
    volumes:
      - type: "volume"
        target: "/var/lib/postgresql/data"
        source: "marketspace.apphost-b8d6486485-postgres-payment-data"
        read_only: false
    networks:
      - "aspire"
  rabbitmq:
    image: "rabbitmq:management"
    environment:
      RABBITMQ_DEFAULT_USER: "guest"
      RABBITMQ_DEFAULT_PASS: "guest"
      RABBITMQ_DEFAULT_VHOST: "/"
    expose:
      - "5672"
      - "15672"
    networks:
      - "aspire"
  minio:
    image: "minio/minio:latest"
    command:
      - "server"
      - "/data"
      - "--console-address"
      - ":9001"
    environment:
      MINIO_ROOT_USER: "admin"
      MINIO_ROOT_PASSWORD: "admin123"
    expose:
      - "9000"
      - "9001"
    volumes:
      - type: "volume"
        target: "/data"
        source: "minio-data"
        read_only: false
    networks:
      - "aspire"
  catalog-api:
    image: "${CATALOG_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${CATALOG_API_PORT};8000"
      HTTPS_PORTS: "8001"
      ConnectionStrings__CatalogDb: "Host=postgres-catalog;Port=5432;Username=postgres;Password=${POSTGRES_PASSWORD};Database=CatalogDb"
      CATALOGDB_HOST: "postgres-catalog"
      CATALOGDB_PORT: "5432"
      CATALOGDB_USERNAME: "postgres"
      CATALOGDB_PASSWORD: "${POSTGRES_PASSWORD}"
      CATALOGDB_URI: "postgresql://postgres:${POSTGRES_PASSWORD}@postgres-catalog:5432/CatalogDb"
      CATALOGDB_JDBCCONNECTIONSTRING: "jdbc:postgresql://postgres-catalog:5432/CatalogDb"
      CATALOGDB_DATABASENAME: "CatalogDb"
      Storage__Minio__Endpoint: "localhost:9000"
      Storage__Minio__AccessKey: "admin"
      Storage__Minio__SecretKey: "admin123"
      Storage__Minio__BucketName: "catalog-bucket"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "catalog-api"
    expose:
      - "${CATALOG_API_PORT}"
      - "8000"
      - "8001"
    networks:
      - "aspire"
  basket-api:
    image: "${BASKET_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${BASKET_API_PORT};8002"
      HTTPS_PORTS: "8003"
      ConnectionStrings__BasketDb: "Host=postgres-basket;Port=5432;Username=postgres;Password=${POSTGRES_PASSWORD};Database=BasketDb"
      BASKETDB_HOST: "postgres-basket"
      BASKETDB_PORT: "5432"
      BASKETDB_USERNAME: "postgres"
      BASKETDB_PASSWORD: "${POSTGRES_PASSWORD}"
      BASKETDB_URI: "postgresql://postgres:${POSTGRES_PASSWORD}@postgres-basket:5432/BasketDb"
      BASKETDB_JDBCCONNECTIONSTRING: "jdbc:postgresql://postgres-basket:5432/BasketDb"
      BASKETDB_DATABASENAME: "BasketDb"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "basket-api"
    expose:
      - "${BASKET_API_PORT}"
      - "8002"
      - "8003"
    depends_on:
      rabbitmq:
        condition: "service_started"
    networks:
      - "aspire"
  order-api:
    image: "${ORDER_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${ORDER_API_PORT};8004"
      HTTPS_PORTS: "8005"
      ConnectionStrings__OrderDb: "Host=postgres-order;Port=5432;Username=postgres;Password=${POSTGRES_PASSWORD};Database=OrderDb"
      ORDERDB_HOST: "postgres-order"
      ORDERDB_PORT: "5432"
      ORDERDB_USERNAME: "postgres"
      ORDERDB_PASSWORD: "${POSTGRES_PASSWORD}"
      ORDERDB_URI: "postgresql://postgres:${POSTGRES_PASSWORD}@postgres-order:5432/OrderDb"
      ORDERDB_JDBCCONNECTIONSTRING: "jdbc:postgresql://postgres-order:5432/OrderDb"
      ORDERDB_DATABASENAME: "OrderDb"
      ConnectionStrings__RabbitMQ: "amqp://guest:guest@localhost:5672/"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "order-api"
    expose:
      - "${ORDER_API_PORT}"
      - "8004"
      - "8005"
    depends_on:
      rabbitmq:
        condition: "service_started"
    networks:
      - "aspire"
  merchant-api:
    image: "${MERCHANT_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${MERCHANT_API_PORT};8006"
      HTTPS_PORTS: "8007"
      ConnectionStrings__MerchantDb: "Host=postgres-merchant;Port=5432;Username=postgres;Password=${POSTGRES_PASSWORD};Database=MerchantDb"
      MERCHANTDB_HOST: "postgres-merchant"
      MERCHANTDB_PORT: "5432"
      MERCHANTDB_USERNAME: "postgres"
      MERCHANTDB_PASSWORD: "${POSTGRES_PASSWORD}"
      MERCHANTDB_URI: "postgresql://postgres:${POSTGRES_PASSWORD}@postgres-merchant:5432/MerchantDb"
      MERCHANTDB_JDBCCONNECTIONSTRING: "jdbc:postgresql://postgres-merchant:5432/MerchantDb"
      MERCHANTDB_DATABASENAME: "MerchantDb"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "merchant-api"
    expose:
      - "${MERCHANT_API_PORT}"
      - "8006"
      - "8007"
    depends_on:
      rabbitmq:
        condition: "service_started"
    networks:
      - "aspire"
  payment-api:
    image: "${PAYMENT_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${PAYMENT_API_PORT};8008"
      HTTPS_PORTS: "8009"
      ConnectionStrings__PaymentDb: "Host=postgres-payment;Port=5432;Username=postgres;Password=${POSTGRES_PASSWORD};Database=PaymentDb"
      PAYMENTDB_HOST: "postgres-payment"
      PAYMENTDB_PORT: "5432"
      PAYMENTDB_USERNAME: "postgres"
      PAYMENTDB_PASSWORD: "${POSTGRES_PASSWORD}"
      PAYMENTDB_URI: "postgresql://postgres:${POSTGRES_PASSWORD}@postgres-payment:5432/PaymentDb"
      PAYMENTDB_JDBCCONNECTIONSTRING: "jdbc:postgresql://postgres-payment:5432/PaymentDb"
      PAYMENTDB_DATABASENAME: "PaymentDb"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "payment-api"
    expose:
      - "${PAYMENT_API_PORT}"
      - "8008"
      - "8009"
    depends_on:
      rabbitmq:
        condition: "service_started"
    networks:
      - "aspire"
  user-api:
    image: "${USER_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${USER_API_PORT};8010"
      HTTPS_PORTS: "8011"
      ConnectionStrings__UserDb: "Host=postgres-user;Port=5432;Username=postgres;Password=${POSTGRES_PASSWORD};Database=UserDb"
      USERDB_HOST: "postgres-user"
      USERDB_PORT: "5432"
      USERDB_USERNAME: "postgres"
      USERDB_PASSWORD: "${POSTGRES_PASSWORD}"
      USERDB_URI: "postgresql://postgres:${POSTGRES_PASSWORD}@postgres-user:5432/UserDb"
      USERDB_JDBCCONNECTIONSTRING: "jdbc:postgresql://postgres-user:5432/UserDb"
      USERDB_DATABASENAME: "UserDb"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "user-api"
    expose:
      - "${USER_API_PORT}"
      - "8010"
      - "8011"
    depends_on:
      rabbitmq:
        condition: "service_started"
    networks:
      - "aspire"
  backendforfrontend-api:
    image: "${BACKENDFORFRONTEND_API_IMAGE}"
    environment:
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES: "true"
      OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY: "in_memory"
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: "true"
      HTTP_PORTS: "${BACKENDFORFRONTEND_API_PORT};8012"
      HTTPS_PORTS: "8013"
      CATALOG_API_HTTP: "http://catalog-api:${CATALOG_API_PORT}"
      services__catalog-api__http__0: "http://catalog-api:${CATALOG_API_PORT}"
      CATALOG_API_HTTPS: "https://catalog-api:${CATALOG_API_PORT}"
      CATALOG_API_CATALOG_HTTP: "http://catalog-api:8000"
      services__catalog-api__catalog-http__0: "http://catalog-api:8000"
      CATALOG_API_CATALOG_HTTPS: "https://catalog-api:8001"
      BASKET_API_HTTP: "http://basket-api:${BASKET_API_PORT}"
      services__basket-api__http__0: "http://basket-api:${BASKET_API_PORT}"
      BASKET_API_HTTPS: "https://basket-api:${BASKET_API_PORT}"
      BASKET_API_BASKET_HTTP: "http://basket-api:8002"
      services__basket-api__basket-http__0: "http://basket-api:8002"
      BASKET_API_BASKET_HTTPS: "https://basket-api:8003"
      ORDER_API_HTTP: "http://order-api:${ORDER_API_PORT}"
      services__order-api__http__0: "http://order-api:${ORDER_API_PORT}"
      ORDER_API_HTTPS: "https://order-api:${ORDER_API_PORT}"
      ORDER_API_ORDER_HTTP: "http://order-api:8004"
      services__order-api__order-http__0: "http://order-api:8004"
      ORDER_API_ORDER_HTTPS: "https://order-api:8005"
      MERCHANT_API_HTTP: "http://merchant-api:${MERCHANT_API_PORT}"
      services__merchant-api__http__0: "http://merchant-api:${MERCHANT_API_PORT}"
      MERCHANT_API_HTTPS: "https://merchant-api:${MERCHANT_API_PORT}"
      MERCHANT_API_MERCHANT_HTTP: "http://merchant-api:8006"
      services__merchant-api__merchant-http__0: "http://merchant-api:8006"
      MERCHANT_API_MERCHANT_HTTPS: "https://merchant-api:8007"
      USER_API_HTTP: "http://user-api:${USER_API_PORT}"
      services__user-api__http__0: "http://user-api:${USER_API_PORT}"
      USER_API_HTTPS: "https://user-api:${USER_API_PORT}"
      USER_API_USER_HTTP: "http://user-api:8010"
      services__user-api__user-http__0: "http://user-api:8010"
      USER_API_USER_HTTPS: "https://user-api:8011"
      PAYMENT_API_HTTP: "http://payment-api:${PAYMENT_API_PORT}"
      services__payment-api__http__0: "http://payment-api:${PAYMENT_API_PORT}"
      PAYMENT_API_HTTPS: "https://payment-api:${PAYMENT_API_PORT}"
      PAYMENT_API_PAYMENT_HTTP: "http://payment-api:8008"
      services__payment-api__payment-http__0: "http://payment-api:8008"
      PAYMENT_API_PAYMENT_HTTPS: "https://payment-api:8009"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://compose-dashboard:18889"
      OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
      OTEL_SERVICE_NAME: "backendforfrontend-api"
    expose:
      - "${BACKENDFORFRONTEND_API_PORT}"
      - "8012"
      - "8013"
    depends_on:
      rabbitmq:
        condition: "service_started"
    networks:
      - "aspire"
networks:
  aspire:
    driver: "bridge"
volumes:
  marketspace.apphost-b8d6486485-postgres-catalog-data:
    driver: "local"
  marketspace.apphost-b8d6486485-postgres-order-data:
    driver: "local"
  marketspace.apphost-b8d6486485-postgres-merchant-data:
    driver: "local"
  marketspace.apphost-b8d6486485-postgres-user-data:
    driver: "local"
  marketspace.apphost-b8d6486485-postgres-basket-data:
    driver: "local"
  marketspace.apphost-b8d6486485-postgres-payment-data:
    driver: "local"
  minio-data:
    driver: "local"
